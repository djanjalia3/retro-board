<!-- Display Name Prompt -->
@if (namePromptVisible) {
<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
  <mat-card class="w-full max-w-sm">
    <mat-card-content class="p-8">
      <h2 class="text-lg font-semibold text-gray-800 mb-4">Enter your display name</h2>
      <mat-form-field class="w-full" appearance="outline">
        <mat-label>Your name</mat-label>
        <input matInput [(ngModel)]="displayName" (keyup.enter)="setDisplayName()" />
      </mat-form-field>
      <button
        mat-raised-button
        color="primary"
        class="w-full"
        (click)="setDisplayName()"
        [disabled]="!displayName.trim()"
      >
        Join Board
      </button>
    </mat-card-content>
  </mat-card>
</div>
}

<!-- Board Content -->
@if (board) {
<div class="min-h-screen bg-gray-100 p-4">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6 flex-wrap gap-3">
    <h1 class="text-2xl font-bold text-gray-800">{{ board.name }}</h1>
    <div class="flex items-center gap-4 text-sm text-gray-500">
      <span>Board ID: <code class="bg-gray-200 px-2 py-0.5 rounded text-xs">{{ boardId }}</code></span>
      <span>Joined as: <strong>{{ displayName }}</strong></span>
      <button mat-raised-button class="!bg-emerald-600 !text-white" (click)="exportToExcel()">
        <mat-icon class="mr-1">download</mat-icon>
        Export Excel
      </button>
    </div>
  </div>

  <!-- Columns Grid -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    @for (column of board.columns; track column; let i = $index) {
    <mat-card>
      <mat-card-content class="p-4">
        <!-- Column Header -->
        <h2
          class="text-center font-semibold text-white py-2.5 rounded-lg mb-4 text-sm"
          [ngClass]="columnColors[i]"
        >
          {{ column }}
        </h2>

        <!-- Add Card -->
        <div class="mb-4">
          <div class="flex gap-2 items-start">
            <mat-form-field class="flex-1" appearance="outline" subscriptSizing="dynamic">
              <mat-label>Add a card...</mat-label>
              <input matInput [(ngModel)]="newCardTexts[i]" (keyup.enter)="addCard(i)" />
            </mat-form-field>
            <button
              mat-mini-fab
              color="primary"
              (click)="addCard(i)"
              [disabled]="!newCardTexts[i]?.trim()"
              class="mt-1"
            >
              <mat-icon>add</mat-icon>
            </button>
          </div>
          <mat-checkbox [(ngModel)]="postAnonymously[i]" class="text-xs text-gray-500">
            Post anonymously
          </mat-checkbox>
        </div>

        <!-- Cards -->
        @for (card of getCardsForColumn(i); track card.id) {
        <div class="border border-gray-200 bg-gray-50 rounded-lg p-3 mb-2">
          <p class="mb-2 text-sm text-gray-800">{{ card.text }}</p>
          <div class="flex items-center justify-between text-xs text-gray-500">
            <span [class.italic]="card.author === 'Anonymous'">{{ card.author }}</span>
            <button
              mat-stroked-button
              (click)="vote(card.id)"
              [disabled]="card.hasVoted"
              class="!min-w-0 !px-3 !py-0.5 !text-xs !rounded-full"
            >
              <mat-icon class="!text-sm !w-4 !h-4 mr-1">arrow_upward</mat-icon>
              {{ card.votes }}
            </button>
          </div>
        </div>
        }
      </mat-card-content>
    </mat-card>
    }
  </div>
</div>
}

<!-- Loading -->
@if (!board && !namePromptVisible) {
<div class="flex min-h-screen items-center justify-center flex-col gap-2">
  @if (loadError) {
    <p class="text-red-600">Error: {{ loadError }}</p>
  } @else {
    <p class="text-gray-500">Loading board...</p>
  }
  <p class="text-gray-400 text-xs">Board ID: {{ boardId }}</p>
</div>
}
